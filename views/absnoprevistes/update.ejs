<!DOCTYPE html>
<html lang="en">
	<head>
		<%- include('../partials/head'); %>
	</head>
	<body class="container">
		<header><%- include('../partials/header'); %></header>
		<main>
			<script>
				function setDefaultDate() {
				const now = new Date();
				const day = now.getDate().toString().padStart(2, '0');
				const month = (now.getMonth() + 1).toString().padStart(2, '0');
				const year = now.getFullYear().toString();
				const today = `${year}-${month}-${day}`;

	 		document.getElementById('data_actual').value = today;
			}

			window.onload = function() {
  				setDefaultDate();
}

			</script>
			<div class="card mt-4">
				<div class="card-header">
					<h5 class="card-title">Editar absencia no prevista</h5>
				</div>
				<div class="card-body">
					<form method="POST" action="/absnoprevistes/update/<%= absnoprevista._id %>">
						<div class="form-group">
							<!-- Input para comparar la fecha de la sortida con la fecha actual para que no hayan errores de validacion-->
						<input type="date" name="data_actual" id="data_actual" class="form-control" style="display:none"/>

							<label for="name">La data de l'absència no prevista NO és editable</label><br>
							<input type="date" name="data_absnoprevista" class="form-control" style="display:none" value="<%= absnoprevista.data_absnoprevista instanceof Date ? absnoprevista.data_absnoprevista.toISOString().slice(0, 10) : '' %>"/>

							<label class="form-label" for="hora_inici_absnoprevista">Hora inici</label>
							<br>
								<select class="form-select" id="hora_inici_absnoprevista" name="hora_inici_absnoprevista" value="hora_inici_absnoprevista">
							<optgroup label="Diurn">
									<option value="08:00" <%= absnoprevista.hora_inici_absnoprevista === '08:00' ? 'selected' : '' %>>08:00</option>
									<option value="09:00" <%= absnoprevista.hora_inici_absnoprevista === '09:00' ? 'selected' : '' %>>09:00</option>
									<option value="10:00" <%= absnoprevista.hora_inici_absnoprevista === '10:00' ? 'selected' : '' %>>10:00</option>
									<option value="11:00" <%= absnoprevista.hora_inici_absnoprevista === '11:00' ? 'selected' : '' %>>11:00</option>
									<option value="11:30" <%= absnoprevista.hora_inici_absnoprevista === '11:30' ? 'selected' : '' %>>11:30</option>
									<option value="12:30" <%= absnoprevista.hora_inici_absnoprevista === '12:30' ? 'selected' : '' %>>12:30</option>
									<option value="13:30" <%= absnoprevista.hora_inici_absnoprevista === '13:30' ? 'selected' : '' %>>13:30</option>
								</optgroup>
								<optgroup label="Nocturn">
									<option value="15:00" <%= absnoprevista.hora_inici_absnoprevista === '15:00' ? 'selected' : '' %>>15:00</option>
									<option value="16:00" <%= absnoprevista.hora_inici_absnoprevista === '16:00' ? 'selected' : '' %>>16:00</option>
									<option value="17:00" <%= absnoprevista.hora_inici_absnoprevista === '17:00' ? 'selected' : '' %>>17:00</option>
									<option value="18:30" <%= absnoprevista.hora_inici_absnoprevista === '18:30' ? 'selected' : '' %>>18:30</option>
									<option value="19:30" <%= absnoprevista.hora_inici_absnoprevista === '19:30' ? 'selected' : '' %>>19:30</option>
									<option value="20:30" <%= absnoprevista.hora_inici_absnoprevista === '20:30' ? 'selected' : '' %>>20:30</option>
									</optgroup>
							</select>
							<br>
							<br>

								<label class="form-label" for="hora_final_absnoprevista">Hora arribada</label>
								<br>
								<select class="form-select" id="hora_final_absnoprevista" name="hora_final_absnoprevista" value="hora_final_absnoprevista">
							<optgroup label="Diurn">
									<option value="08:00" <%= absnoprevista.hora_final_absnoprevista === '08:00' ? 'selected' : '' %>>08:00</option>
									<option value="09:00" <%= absnoprevista.hora_final_absnoprevista === '09:00' ? 'selected' : '' %>>09:00</option>
									<option value="10:00" <%= absnoprevista.hora_final_absnoprevista === '10:00' ? 'selected' : '' %>>10:00</option>
									<option value="11:00" <%= absnoprevista.hora_final_absnoprevista === '11:00' ? 'selected' : '' %>>11:00</option>
									<option value="11:30" <%= absnoprevista.hora_final_absnoprevista === '11:30' ? 'selected' : '' %>>11:30</option>
									<option value="12:30" <%= absnoprevista.hora_final_absnoprevista === '12:30' ? 'selected' : '' %>>12:30</option>
									<option value="13:30" <%= absnoprevista.hora_final_absnoprevista === '13:30' ? 'selected' : '' %>>13:30</option>
									<option value="14:30" <%= absnoprevista.hora_final_absnoprevista === '14:30' ? 'selected' : '' %>>14:30</option>
								</optgroup>
								<optgroup label="Nocturn">
									<option value="15:00" <%= absnoprevista.hora_final_absnoprevista === '15:00' ? 'selected' : '' %>>15:00</option>
									<option value="16:00" <%= absnoprevista.hora_final_absnoprevista === '16:00' ? 'selected' : '' %>>16:00</option>
									<option value="17:00" <%= absnoprevista.hora_final_absnoprevista === '17:00' ? 'selected' : '' %>>17:00</option>
									<option value="18:30" <%= absnoprevista.hora_final_absnoprevista === '18:30' ? 'selected' : '' %>>18:30</option>
									<option value="19:30" <%= absnoprevista.hora_final_absnoprevista === '19:30' ? 'selected' : '' %>>19:30</option>
									<option value="20:30" <%= absnoprevista.hora_final_absnoprevista === '20:30' ? 'selected' : '' %>>20:30</option>
								</optgroup>
						</select>
						<br>
						<br>
							<label for="name">Motiu absència</label>
							<textarea name="motiu_abs" class="form-control"><%= absnoprevista.motiu_abs %></textarea>

							<label for="name">Document justificatiu</label>
							<input type="file" name="document_justificatiu" class="form-control" value="<%= absnoprevista.document_justificatiu %>"/>
						</div>
						<button type="submit" class="btn btn-primary">Desar</button>
						<a class="btn btn-danger" href="/absnoprevistes/delete/<%= absnoprevista._id %>" role="button">Esborrar</a>
					</form>
					<% if (typeof error !=="undefined" ) { %>
					<div class="alert alert-primary mt-2" role="alert">
						<p><%= error %></p>
					</div>
					<% } %> <% if (typeof message !=="undefined" ) { %>
					<div class="alert alert-primary mt-2" role="alert">
						<p><%= message %></p>
					</div>
					<% } %>
				</div>
				<% if (typeof errors !== "undefined") { %>
					<div class="alert alert-danger mt-2" role="alert">
						<% errors.forEach(function(error) { %>
							<p><%= error.msg %></p>
						<% }) %>
					</div>
				<% } %>
			</div>
		</main>
		<footer><%- include('../partials/footer'); %></footer>
	</body>
</html>
